!function(e){e([],function(){var e=-1,r=-2,n=-3,t=-4,i=-5,o=function(o,s){s=s||{};var l=s.verbose||!1;l&&console.log("Normalize the JSON Object"),o="string"==typeof o?this.JSON.parse(o):o,l&&console.log("Creating a empty dictionary");var f={strings:[],integers:[],floats:[]};l&&console.log("Creating the AST");{var g=function d(o){l&&console.log("Calling recursiveAstBuilder with "+this.JSON.stringify(o));var s=typeof o;if(null===o)return{type:"null",index:n};if("undefined"==typeof o)return{type:"undefined",index:i};if(o instanceof Array){var g=["@"];for(var p in o)o.hasOwnProperty(p)&&g.push(d(o[p]));return g}if("object"===s){var g=["$"];for(var h in o)o.hasOwnProperty(h)&&(g.push(d(h)),g.push(d(o[h])));return g}if(""===o)return{type:"empty",index:t};if("string"===s){var v=c.call(f.strings,o);return-1==v&&(f.strings.push(a(o)),v=f.strings.length-1),{type:"strings",index:v}}if("number"===s&&o%1===0){var v=c.call(f.integers,o);return-1==v&&(f.integers.push(u(o)),v=f.integers.length-1),{type:"integers",index:v}}if("number"===s){var v=c.call(f.floats,o);return-1==v&&(f.floats.push(o),v=f.floats.length-1),{type:"floats",index:v}}if("boolean"===s)return{type:"boolean",index:o?e:r};throw new Error("Unexpected argument of type "+typeof o)}(o),p=f.strings.length,h=f.integers.length;f.floats.length}l&&console.log("Parsing the dictionary");var v=f.strings.join("|");return v+="^"+f.integers.join("|"),v+="^"+f.floats.join("|"),l&&console.log("Parsing the structure"),v+="^"+function y(e){if(l&&console.log("Calling a recursiveParser with "+this.JSON.stringify(e)),e instanceof Array){var r=e.shift();for(var o in e)e.hasOwnProperty(o)&&(r+=y(e[o])+"|");return("|"===r[r.length-1]?r.slice(0,-1):r)+"]"}var s=e.type,a=e.index;if("strings"===s)return u(a);if("integers"===s)return u(p+a);if("floats"===s)return u(p+h+a);if("boolean"===s)return e.index;if("null"===s)return n;if("undefined"===s)return i;if("empty"===s)return t;throw new TypeError("The item is alien!")}(g),l&&console.log("Ending parser"),s.debug?{dictionary:f,ast:g,packed:v}:v},s=function(o,s){s=s||{};var a=o.split("^");s.verbose&&console.log("Building dictionary");var u=[],c=a[0];if(""!==c){c=c.split("|"),s.verbose&&console.log("Parse the strings dictionary");for(var g=0,p=c.length;p>g;g++)u.push(l(c[g]))}if(c=a[1],""!==c){c=c.split("|"),s.verbose&&console.log("Parse the integers dictionary");for(var g=0,p=c.length;p>g;g++)u.push(f(c[g]))}if(c=a[2],""!==c){c=c.split("|"),s.verbose&&console.log("Parse the floats dictionary");for(var g=0,p=c.length;p>g;g++)u.push(parseFloat(c[g]))}delete c,s.verbose&&console.log("Tokenizing the structure");for(var h="",v=[],d=a[3].length,g=0;d>g;g++){var y=a[3].charAt(g);"|"===y||"$"===y||"@"===y||"]"===y?(h&&(v.push(f(h)),h=""),"|"!==y&&v.push(y)):h+=y}var b=v.length,k=0;return s.verbose&&console.log("Starting recursive parser"),function w(){var o=v[k++];if(s.verbose&&console.log("Reading collection type "+("$"===o?"object":"Array")),"@"===o){for(var a=[];b>k;k++){var l=v[k];if(s.verbose&&console.log("Read "+l+" symbol"),"]"===l)return a;if("@"===l||"$"===l)a.push(w());else switch(l){case e:a.push(!0);break;case r:a.push(!1);break;case n:a.push(null);break;case i:a.push(void 0);break;case t:a.push("");break;default:a.push(u[l])}}return s.verbose&&console.log("Parsed "+this.JSON.stringify(a)),a}if("$"===o){for(var a={};b>k;k++){var f=v[k];if("]"===f)return a;f=f===t?"":u[f];var l=v[++k];if("@"===l||"$"===l)a[f]=w();else switch(l){case e:a[f]=!0;break;case r:a[f]=!1;break;case n:a[f]=null;break;case i:a[f]=void 0;break;case t:a[f]="";break;default:a[f]=u[l]}}return s.verbose&&console.log("Parsed "+this.JSON.stringify(a)),a}throw new TypeError("Bad token "+o+" isn't a type")}()},a=function(e){return"string"!=typeof e?e:e.replace(/[\+ \|\^\%]/g,function(e){return{" ":"+","+":"%2B","|":"%7C","^":"%5E","%":"%25"}[e]})},l=function(e){return"string"!=typeof e?e:e.replace(/\+|%2B|%7C|%5E|%25/g,function(e){return{"+":" ","%2B":"+","%7C":"|","%5E":"^","%25":"%"}[e]})},u=function(e){return Number.prototype.toString.call(e,36).toUpperCase()},f=function(e){return parseInt(e,36)},c=Array.prototype.indexOf||function(e,r){for(var n=r||0,t=this.length;t>n;n++)if(this[n]===e)return n;return-1};return{JSON:JSON,pack:o,unpack:s}})}("undefined"!=typeof define&&define.amd?define:function(e,r){var n=r();if("undefined"!=typeof exports)for(var t in n)exports[t]=n[t];else window.jsonpack=n});